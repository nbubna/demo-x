/*! demo-x - v0.1.0 - 2014-12-02
* http://esha.github.io/demo-x/
* Copyright (c) 2014 ESHA Research; Licensed MIT */
!function(window,D){"use strict";var DemoX=function a(b){return this instanceof a?void(b.demo||this.init(b)):new a(b)};DemoX.prototype={timing:{intent:1e3,backspace:25,typing:50,tick:250,minTicks:8},init:function(a){var b=a.demo=this;if(b.root=a,b.display=a.query("demo-dom"),b.input=a.query("demo-in"),b.output=a.query("demo-out"),b.intent(b.input),b._exec=function(){b.execute()},b.input.children.length&&b.initStory(),b.display){b.doc=DemoX.docify(b.display.children);for(var c=0;c<b.display.attributes.length;c++){var d=b.display.attributes[c];b.doc.body.setAttribute(d.name,d.value)}b.initDisplay()}else b.doc=DemoX.docify(new DOMxList);b.initControls()},initDisplay:function(){function a(){b.display.innerHTML=b.doc.body.stringify(!0)}var b=this;a(),b._observer=new MutationObserver(a).observe(b.doc.html,{childList:!0,subtree:!0,attributes:!0,characterData:!0})},initStory:function(){var a=this;a._next=function(){a.next()},a.story=a.input.children.each("textContent"),a.input.innerHTML="",this._tick=function(){a.index&&a.execute(),setTimeout(a._next,a.calcPause())},this._tick()},initControls:function(){var a=this,b=a.root.query("[stop]"),c=a.root.query("[start]");a._stop=function(){a.stopped=!0,a.root.classList.add("stopped")},a._start=function(){a.root.classList.remove("stopped"),a.index in a.story||(a.index=0),a.stopped=!1,a.next()},a.input.addEventListener("keydown",a._stop),b&&b.addEventListener("click",a._stop),c&&c.addEventListener("click",a._start)},next:function(){var a=this,b=a.story[a.index];if(b&&!a.stopped){var c=a.input;a.animate(a.input.value,b,function(a){c.value=a},a._tick),a.index++}else b||a._stop()},calcPause:function(){var a=this.story[this.index-1]||"";return!a||0===a.indexOf("//")&&a.indexOf("\n")<0?0:Math.max(a.replace(/\w|\s/g,"").length,this.timing.minTicks)*this.timing.tick},intent:function(a){var b,c=this;a.addEventListener("keydown",function(){b&&clearTimeout(b),b=setTimeout(c._exec,c.timing.intent)})},execute:function(){var code=this.input.value,result;if(code&&0!==code.indexOf("//")){try{result=eval(code),DemoX.flash(result)}catch(e){e.code=code,result=e}if(this.output){var log=this.output.innerHTML;this.output.innerHTML='<p class="line">'+DemoX.describe(result)+"</p>"+log}else console.log(code),console.log(result)}},animate:function(a,b,c,d){var e=a.length,f=this,g="typing";!function h(){if(!f.stopped){if(b.indexOf(a)<0)g="backspace",a=a.substr(0,--e);else{if(!(e<b.length))return d();g="typing",a=b.substr(0,++e)}c(a),setTimeout(h,f.timing[g])}}()},index:0},DemoX.docify=function(a){var b=D.createDocumentFragment();b.html=b.documentElement=D.createElement("html"),b.appendChild(b.html),b.html.appendChild(b.body=D.createElement("body")),a.each(function(a){a.remove(),b.body.append(a)}),b.html.dot();try{delete b.parentNode,b.parentNode=window}catch(c){}return b},DemoX.describe=function(a){if(D.x._.isList(a)&&a.each)return a.each(DemoX.describe).join(", ");if(a instanceof HTMLElement){var b=a.getAttribute("id"),c=a.getAttribute("class");return"&lt;"+a.tagName.toLowerCase()+(b?"#"+b:"")+(c?"."+c.split(" ").join("."):"")+"&gt;"}return a instanceof Node?a.value:"object"==typeof a?JSON.stringify(a):a&&a.value||a+""},DemoX.highlight=function(a){a.setAttribute&&a.setAttribute("_highlight","true")},DemoX.unhighlight=function(a){a.removeAttribute&&a.removeAttribute("_highlight")};var flashTimeout;DemoX.flash=function(a){a&&a.each&&(flashTimeout&&clearTimeout(flashTimeout),flashTimeout=setTimeout(function(){a.each(DemoX.highlight),setTimeout(function(){a.each(DemoX.unhighlight)},1e3)},DemoX.flash.time||100))},DemoX.onload=function(){D.queryAll("demo-x").each(DemoX)},window.DemoX=DemoX,DemoX.onload(),D.addEventListener("DOMContentLoaded",DemoX.onload)}(window,document);